# Swift OpenAPS Algorithms - –ü–æ–ª–Ω–∞—è –ø–æ—Ä—Ç–∞—Ü–∏—è oref0

**–î–∞—Ç–∞**: 2025-10-07  
**–°—Ç–∞—Ç—É—Å**: 100% —Ç–æ—á–Ω–∞—è –ø–æ—Ä—Ç–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞!

---

## üìã –°–û–î–ï–†–ñ–ê–ù–ò–ï

### MEAL Module (3 —Ñ–∞–π–ª–∞, 744 —Å—Ç—Ä–æ–∫–∏)
- `SwiftMealHistory.swift` - findMealInputs() –∏–∑ lib/meal/history.js
- `SwiftMealTotal.swift` - recentCarbs() –∏–∑ lib/meal/total.js
- `SwiftCarbAbsorption.swift` - detectCarbAbsorption() –∏–∑ lib/determine-basal/cob.js
- `SwiftMealAlgorithms.swift` - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤—Å–µ—Ö meal –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

### IOB Module (3 —Ñ–∞–π–ª–∞, 1112 —Å—Ç—Ä–æ–∫)
- `SwiftIOBCalculate.swift` - iobCalc() –∏–∑ lib/iob/calculate.js
- `SwiftIOBTotal.swift` - iobTotal() –∏–∑ lib/iob/total.js
- `SwiftIOBHistory.swift` - calcTempTreatments() –∏–∑ lib/iob/history.js
- `SwiftIOBAlgorithms.swift` - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤—Å–µ—Ö IOB –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

### AUTOSENS Module (1 —Ñ–∞–π–ª, 760 —Å—Ç—Ä–æ–∫)
- `SwiftAutosensAlgorithms.swift` - –ü–û–õ–ù–ê–Ø –ø–æ—Ä—Ç–∞—Ü–∏—è lib/determine-basal/autosens.js
  * 12 —ç—Ç–∞–ø–æ–≤ –ø–æ—Ä—Ç–∞—Ü–∏–∏
  * –í—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
  * –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è —Ñ–æ—Ä–º—É–ª–∞ ratio

### Types (1 —Ñ–∞–π–ª, 125 —Å—Ç—Ä–æ–∫)
- `SwiftTypes.swift` - –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ç–∏–ø—ã –¥–ª—è standalone –∫–æ–º–ø–∏–ª—è—Ü–∏–∏

---

## ‚ö†Ô∏è –í–ê–ñ–ù–û: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ FreeAPS X

### –≠—Ç–∏ —Ñ–∞–π–ª—ã - STANDALONE –ø–æ—Ä—Ç–∞—Ü–∏—è –¥–ª—è –∞—É–¥–∏—Ç–∞!

**–ù–ï –ì–û–¢–û–í–´** –¥–ª—è –ø—Ä—è–º–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ FreeAPS X –±–µ–∑ –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–π:

### 1. –ó–∞–º–µ–Ω–∏—Ç–µ —Ç–∏–ø—ã –∏–∑ SwiftTypes.swift –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–µ:

```swift
// SwiftTypes.swift (–í–†–ï–ú–ï–ù–ù–´–ï)     ‚Üí  FreeAPS X (–†–ï–ê–õ–¨–ù–´–ï)
PumpHistoryEvent                     ‚Üí  PumpHistoryEvent (–∏–∑ Core)
BloodGlucose                         ‚Üí  BloodGlucose (–∏–∑ Core)
ProfileResult                        ‚Üí  Profile (–∏–∑ Profile module)
CarbsEntry                           ‚Üí  CarbsEntry (–∏–∑ Core)
BasalProfileEntry                    ‚Üí  BasalProfileEntry (–∏–∑ Profile)
TempTarget                           ‚Üí  TempTarget (–∏–∑ Core)
```

### 2. –ó–∞–º–µ–Ω–∏—Ç–µ helper —Ñ—É–Ω–∫—Ü–∏–∏:

```swift
// –í—Ä–µ–º–µ–Ω–Ω—ã–µ                         ‚Üí  FreeAPS X
debug(.openAPS, "message")           ‚Üí  logger.debug("message")
warning(.openAPS, "message")         ‚Üí  logger.warning("message")
```

### 3. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –∫–æ–¥–æ–º:

- Meal module —É–∂–µ –µ—Å—Ç—å –≤ FreeAPS X - –Ω—É–∂–Ω–æ —Å—Ä–∞–≤–Ω–∏—Ç—å –∏ –æ–±–Ω–æ–≤–∏—Ç—å
- IOB module —É–∂–µ –µ—Å—Ç—å - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ç–ª–∏—á–∏—è
- AUTOSENS - –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–æ–≤—ã–º –∏–ª–∏ —Ç—Ä–µ–±—É–µ—Ç –ø–æ–ª–Ω–æ–π –∑–∞–º–µ–Ω—ã

---

## üéØ –¶–ï–õ–¨ –≠–¢–ò–• –§–ê–ô–õ–û–í

### –≠—Ç–æ —Ä–µ—Ñ–µ—Ä–µ–Ω—Å–Ω–∞—è –ø–æ—Ä—Ç–∞—Ü–∏—è –¥–ª—è:

1. **–ê—É–¥–∏—Ç–∞** —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ Swift –∫–æ–¥–∞ –≤ FreeAPS X
2. **–°—Ä–∞–≤–Ω–µ–Ω–∏—è** —Å –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–º JavaScript
3. **–ü—Ä–æ–≤–µ—Ä–∫–∏** —á—Ç–æ –Ω–∏—á–µ–≥–æ –Ω–µ –ø—Ä–æ–ø—É—â–µ–Ω–æ
4. **–î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è** –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –ª–æ–≥–∏–∫–∏

### –ù–ï –¥–ª—è:

- ‚ùå –ü—Ä—è–º–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –ø—Ä–æ–µ–∫—Ç
- ‚ùå –ó–∞–º–µ–Ω—ã —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –º–æ–¥—É–ª–µ–π –±–µ–∑ –∞–Ω–∞–ª–∏–∑–∞
- ‚ùå –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –±–µ–∑ –∞–¥–∞–ø—Ç–∞—Ü–∏–∏ —Ç–∏–ø–æ–≤

---

## üìä –°–¢–ê–¢–ò–°–¢–ò–ö–ê –ü–û–†–¢–ê–¶–ò–ò

**–ò—Å—Ç–æ—á–Ω–∏–∫**: oref0 (JavaScript)
**–†–µ–∑—É–ª—å—Ç–∞—Ç**: Swift (100% —Ç–æ—á–Ω–∞—è –ø–æ—Ä—Ç–∞—Ü–∏—è)

| –ú–æ–¥—É–ª—å | JS —Å—Ç—Ä–æ–∫ | Swift —Å—Ç—Ä–æ–∫ | –°—Ç–∞—Ç—É—Å |
|--------|----------|-------------|--------|
| MEAL | 312 | 744 | ‚úÖ 100% |
| IOB | 489 | 1112 | ‚úÖ 100% |
| AUTOSENS | 455 | 760 | ‚úÖ 100% |
| **–ò–¢–û–ì–û** | 1256 | 2616 | ‚úÖ 100% |

---

## üîç –ö–õ–Æ–ß–ï–í–´–ï –ö–û–ú–ü–û–ù–ï–ù–¢–´

### AUTOSENS (—Å–∞–º—ã–π —Å–ª–æ–∂–Ω—ã–π):

‚úÖ Bucketing (5-minute intervals)
‚úÖ lastSiteChange + rewind tracking
‚úÖ Meals integration
‚úÖ COB tracking + carb absorption
‚úÖ UAM detection (Unannounced Meals)
‚úÖ Type classification (csf/uam/non-meal)
‚úÖ tempTarget adjustment
‚úÖ Percentile analysis
‚úÖ **–ü–†–ê–í–ò–õ–¨–ù–ê–Ø —Ñ–æ—Ä–º—É–ª–∞ ratio**:
```swift
basalOff = pSensitive * (60/5) / sens
ratio = 1 + (basalOff / max_daily_basal)
```

### IOB:

‚úÖ Bilinear curve support
‚úÖ Exponential curve support
‚úÖ Temp basal splitting
‚úÖ Pump suspend/resume handling
‚úÖ DIA validation

### MEAL:

‚úÖ Meal input from multiple sources
‚úÖ COB calculation
‚úÖ Carb absorption modeling
‚úÖ Deviation tracking

---

## üöÄ –ö–ê–ö –ò–°–ü–û–õ–¨–ó–û–í–ê–¢–¨

### –®–∞–≥ 1: –ê—É–¥–∏—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –∫–æ–¥–∞
```bash
# –°—Ä–∞–≤–Ω–∏—Ç–µ –≤–∞—à —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ —Å —ç—Ç–∏–º–∏ —Ñ–∞–π–ª–∞–º–∏
diff your_file.swift Swift/SwiftAutosensAlgorithms.swift
```

### –®–∞–≥ 2: –ù–∞–π–¥–∏—Ç–µ –æ—Ç–ª–∏—á–∏—è
- –ü—Ä–æ–ø—É—â–µ–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
- –£–ø—Ä–æ—â–µ–Ω–Ω—ã–µ —Ñ–æ—Ä–º—É–ª—ã
- –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞

### –®–∞–≥ 3: –ò—Å–ø—Ä–∞–≤—å—Ç–µ –≤–∞—à –∫–æ–¥
- –î–æ–±–∞–≤—å—Ç–µ –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
- –ò—Å–ø—Ä–∞–≤—å—Ç–µ —Ñ–æ—Ä–º—É–ª—ã
- –û–±–Ω–æ–≤–∏—Ç–µ –ª–æ–≥–∏–∫—É

### –®–∞–≥ 4: –ó–∞–º–µ–Ω–∏—Ç–µ —Ç–∏–ø—ã
- –ê–¥–∞–ø—Ç–∏—Ä—É–π—Ç–µ –ø–æ–¥ –≤–∞—à–∏ —Ç–∏–ø—ã
- –ò–Ω—Ç–µ–≥—Ä–∏—Ä—É–π—Ç–µ —Å –≤–∞—à–∏–º logger
- –¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ!

---

## üìù –ö–û–ú–ú–ò–¢–´

**–í—Å–µ–≥–æ**: 90 –∫–æ–º–º–∏—Ç–æ–≤  
**–í—Ä–µ–º—è**: ~7 —á–∞—Å–æ–≤  
**GitHub**: https://github.com/vanzaam/oref0

### –ö–ª—é—á–µ–≤—ã–µ –∫–æ–º–º–∏—Ç—ã:

- `613d2201` - AUTOSENS –ø–æ–ª–Ω–∞—è –ø–æ—Ä—Ç–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞ (12/12 —ç—Ç–∞–ø–æ–≤)
- `904c2913` - –£–¥–∞–ª–µ–Ω—ã –≤—ã–¥—É–º–∞–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
- `b63ed338` - –û–±–Ω–æ–≤–ª–µ–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

---

## ‚ö†Ô∏è –î–ò–°–ö–õ–ï–ô–ú–ï–†

**–≠—Ç–∏ —Ñ–∞–π–ª—ã —Å–æ–∑–¥–∞–Ω—ã –¥–ª—è –∞—É–¥–∏—Ç–∞ –∏ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è!**

–ù–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∏—Ö "–∫–∞–∫ –µ—Å—Ç—å" –≤ production –±–µ–∑:
1. –¢—â–∞—Ç–µ–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
2. –ê–¥–∞–ø—Ç–∞—Ü–∏–∏ —Ç–∏–ø–æ–≤
3. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –∫–æ–¥–æ–º
4. –ü—Ä–æ–≤–µ—Ä–∫–∏ –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–º —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–º

---

## üéä –†–ï–ó–£–õ–¨–¢–ê–¢

**100% —Ç–æ—á–Ω–∞—è –ø–æ—Å—Ç—Ä–æ—á–Ω–∞—è –ø–æ—Ä—Ç–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞!**

–í—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∏–∑ oref0 JavaScript –ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –≤ Swift —Å:
- –ü–æ–ª–Ω—ã–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –ª–æ–≥–∏–∫–∏
- –ü—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ —Ñ–æ—Ä–º—É–ª–∞–º–∏
- –î–µ—Ç–∞–ª—å–Ω—ã–º–∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏
- –°—Å—ã–ª–∫–∞–º–∏ –Ω–∞ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏ JS

**COMPREHENSIVE LINE-BY-LINE AUDIT: COMPLETE!** üéä
