# üö® –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –û–®–ò–ë–ö–ò –í SWIFT-–ü–û–†–¢–ê–¶–ò–ò OREF0

**–î–∞—Ç–∞ –∞–Ω–∞–ª–∏–∑–∞**: 2025-10-07  
**–ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º—ã–µ —Ñ–∞–π–ª—ã**: Swift –ø–æ—Ä—Ç–∞—Ü–∏—è vs –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π oref0 JavaScript

---

## ‚ùå –û–®–ò–ë–ö–ê #1: –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç —Ñ—É–Ω–∫—Ü–∏—è `convert_bg`

### –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã
–§—É–Ω–∫—Ü–∏—è `convert_bg` **–ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç** –≤ Swift-–ø–æ—Ä—Ç–∞—Ü–∏–∏, —Ö–æ—Ç—è –æ–Ω–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **40+ —Ä–∞–∑** –≤ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–º `determine-basal.js`.

### –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –∫–æ–¥ (determine-basal.js:39-49)
```javascript
function convert_bg(value, profile) {
    if (profile.out_units === "mmol/L") {
        return round(value / 18, 1);
    } else {
        return Math.round(value);
    }
}
```

### –ì–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –æ—Ä–∏–≥–∏–Ω–∞–ª–µ
```javascript
// –°—Ç—Ä–æ–∫–∞ 806-818 –≤ determine-basal.js
rT.BGI = convert_bg(bgi, profile);
rT.deviation = convert_bg(deviation, profile);
rT.ISF = convert_bg(sens, profile);
rT.target_bg = convert_bg(target_bg, profile);
rT.reason = "COB: " + rT.COB + ", Dev: " + rT.deviation + ", BGI: " + rT.BGI + 
            ", ISF: " + rT.ISF + ", CR: " + rT.CR + 
            ", minPredBG: " + convert_bg(minPredBG, profile) + 
            ", minGuardBG: " + convert_bg(minGuardBG, profile) + 
            ", IOBpredBG: " + convert_bg(lastIOBpredBG, profile);
```

### –ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è
1. **–í—Å–µ –∑–Ω–∞—á–µ–Ω–∏—è BG –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö –≤—Å–µ–≥–¥–∞ –≤ mg/dL**, –¥–∞–∂–µ –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ mmol/L
2. **–ì—Ä–∞—Ñ–∏–∫–∏ –ø—Ä–æ–≥–Ω–æ–∑–æ–≤** (`predBGs`) –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è mmol/L –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
3. **–°—Ç—Ä–æ–∫–∞ `reason`** —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω–µ–∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
4. **UI –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —á–∏—Å–ª–∞** –¥–ª—è –≤—Å–µ—Ö –ø–æ–ª–µ–π: BGI, deviation, ISF, eventualBG, minPredBG, etc.

### –†–µ—à–µ–Ω–∏–µ
–î–æ–±–∞–≤–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏—é –≤ `SwiftDetermineBasalAlgorithms.swift`:

```swift
/// –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø —Ñ—É–Ω–∫—Ü–∏—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ BG –∏–∑ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ determine-basal.js:39-49
private static func convertBG(_ value: Double, profile: ProfileResult) -> Double {
    if profile.outUnits == "mmol/L" {
        return round(value / 18.0 * 10) / 10  // round to 1 decimal place
    } else {
        return round(value)  // round to integer for mg/dL
    }
}
```

–ò –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ—ë –≤–æ –í–°–ï–• –º–µ—Å—Ç–∞—Ö, –≥–¥–µ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è –∑–Ω–∞—á–µ–Ω–∏—è BG.

---

## ‚ùå –û–®–ò–ë–ö–ê #2: –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –ø–æ–ª–µ `out_units` –≤ ProfileResult

### –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã
–°—Ç—Ä—É–∫—Ç—É—Ä–∞ `ProfileResult` –≤ Swift **–Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–æ–ª–µ `out_units`** (–∏–ª–∏ `outUnits`), –∫–æ—Ç–æ—Ä–æ–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–æ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –µ–¥–∏–Ω–∏—Ü –≤—ã–≤–æ–¥–∞.

### –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –∫–æ–¥ (profile/index.js:153)
```javascript
profile.out_units = inputs.targets.user_preferred_units;
```

### –¢–µ–∫—É—â–∏–π Swift –∫–æ–¥ (SwiftProfileAlgorithms.swift:28-76)
```swift
struct ProfileResult {
    let settings: PumpSettings
    let targets: BGTargets
    let basals: [BasalProfileEntry]
    let isf: InsulinSensitivities
    let carbRatio: CarbRatios
    // ... –¥—Ä—É–≥–∏–µ –ø–æ–ª—è
    // ‚ùå –ù–ï–¢ –ü–û–õ–Ø out_units!
}
```

### –ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è
1. –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å, –≤ –∫–∞–∫–∏—Ö –µ–¥–∏–Ω–∏—Ü–∞—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ö–æ—á–µ—Ç –≤–∏–¥–µ—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
2. –§—É–Ω–∫—Ü–∏—è `convert_bg` –Ω–µ –º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –±–µ–∑ —ç—Ç–æ–≥–æ –ø–æ–ª—è
3. –í—Å–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤—Å–µ–≥–¥–∞ –≤ mg/dL

### –†–µ—à–µ–Ω–∏–µ
–î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ –≤ `ProfileResult`:

```swift
struct ProfileResult {
    // ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª—è
    let outUnits: String  // "mg/dL" –∏–ª–∏ "mmol/L"
    
    // ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø–æ–ª—è
}
```

–ò —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å –µ–≥–æ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø—Ä–æ—Ñ–∏–ª—è:

```swift
let profile = ProfileResult(
    // ... –¥—Ä—É–≥–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
    outUnits: inputs.bgTargets?.units == .mmolL ? "mmol/L" : "mg/dL",
    // ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
)
```

---

## ‚ùå –û–®–ò–ë–ö–ê #3: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ `rawJSON`

### –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã
–í `DetermineBasalResult.rawJSON` (SwiftDetermineBasalAlgorithms.swift:85-122) –≤—Å–µ –∑–Ω–∞—á–µ–Ω–∏—è BG –≤—ã–≤–æ–¥—è—Ç—Å—è **–±–µ–∑ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏**:

```swift
var rawJSON: String {
    // ...
    return """
    {
        "bg": \(bg),  // ‚ùå –ù–µ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ!
        "eventualBG": \(Int(eventualBG.rounded())),  // ‚ùå –ù–µ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ!
        // ...
    }
    """
}
```

### –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –∫–æ–¥
–í JavaScript –≤—Å–µ –∑–Ω–∞—á–µ–Ω–∏—è BG –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ **—É–∂–µ —Å–∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã** —á–µ—Ä–µ–∑ `convert_bg` –ø–µ—Ä–µ–¥ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º –≤ `rT`.

### –ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è
1. JSON-—Ä–µ–∑—É–ª—å—Ç–∞—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç –∑–Ω–∞—á–µ–Ω–∏—è –≤ mg/dL –¥–∞–∂–µ –¥–ª—è mmol/L –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
2. FreeAPS UI –ø–æ–ª—É—á–∞–µ—Ç –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
3. –ì—Ä–∞—Ñ–∏–∫–∏ –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —á–∏—Å–ª–∞

### –†–µ—à–µ–Ω–∏–µ
–ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ BG-–∑–Ω–∞—á–µ–Ω–∏—è –ø–µ—Ä–µ–¥ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º –≤ JSON:

```swift
var rawJSON: String {
    // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –≤—Å–µ BG –∑–Ω–∞—á–µ–Ω–∏—è
    let convertedBG = convertBG(bg, profile: profile)
    let convertedEventualBG = convertBG(eventualBG, profile: profile)
    // ... –∏ —Ç.–¥. –¥–ª—è –≤—Å–µ—Ö BG –∑–Ω–∞—á–µ–Ω–∏–π
    
    return """
    {
        "bg": \(convertedBG),
        "eventualBG": \(Int(convertedEventualBG.rounded())),
        // ...
    }
    """
}
```

---

## ‚ùå –û–®–ò–ë–ö–ê #4: Prediction arrays –Ω–µ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É—é—Ç—Å—è

### –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã
–ú–∞—Å—Å–∏–≤—ã –ø—Ä–æ–≥–Ω–æ–∑–æ–≤ `predBGs` (IOB, COB, UAM, ZT) —Å–æ–¥–µ—Ä–∂–∞—Ç –∑–Ω–∞—á–µ–Ω–∏—è –≤ mg/dL –±–µ–∑ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏.

### –¢–µ–∫—É—â–∏–π –∫–æ–¥ (SwiftDetermineBasalAlgorithms.swift:98-102)
```swift
let predBGsJSON = predBGs.map { key, values in
    let valuesString = values.map { String(Int($0.rounded())) }.joined(separator: ",")
    return "\"\(key)\": [\(valuesString)]"
}.joined(separator: ",")
```

### –ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è
–ì—Ä–∞—Ñ–∏–∫–∏ –ø—Ä–æ–≥–Ω–æ–∑–æ–≤ BG –≤ FreeAPS –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è mmol/L –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.

### –†–µ—à–µ–Ω–∏–µ
```swift
let predBGsJSON = predBGs.map { key, values in
    let convertedValues = values.map { convertBG($0, profile: profile) }
    let valuesString = convertedValues.map { String(Int($0.rounded())) }.joined(separator: ",")
    return "\"\(key)\": [\(valuesString)]"
}.joined(separator: ",")
```

---

## ‚ùå –û–®–ò–ë–ö–ê #5: –°—Ç—Ä–æ–∫–∞ `reason` —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω–µ–∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è

### –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã
–í—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ `reason` —Å–æ–¥–µ—Ä–∂–∞—Ç –∑–Ω–∞—á–µ–Ω–∏—è BG –≤ mg/dL –±–µ–∑ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏.

### –ü—Ä–∏–º–µ—Ä –∏–∑ Swift –∫–æ–¥–∞ (SwiftDetermineBasalAlgorithms.swift:341-342)
```swift
reason: safetyReason + 
    ". Replacing high temp basal of \(currentTemp.rate) with neutral temp of \(adjustedBasal)"
// ‚ùå –ù–µ—Ç –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ BG –∑–Ω–∞—á–µ–Ω–∏–π –≤ reason!
```

### –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –∫–æ–¥ (determine-basal.js:811-817)
```javascript
rT.reason = "COB: " + rT.COB + ", Dev: " + rT.deviation + ", BGI: " + rT.BGI + 
            ", ISF: " + rT.ISF + ", CR: " + rT.CR + 
            ", minPredBG: " + convert_bg(minPredBG, profile) +  // ‚úÖ –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ!
            ", minGuardBG: " + convert_bg(minGuardBG, profile) +  // ‚úÖ –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ!
            ", IOBpredBG: " + convert_bg(lastIOBpredBG, profile);  // ‚úÖ –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ!
```

### –ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤–∏–¥—è—Ç –≤ –ª–æ–≥–∞—Ö –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è—Ö –∑–Ω–∞—á–µ–Ω–∏—è –≤ mg/dL –≤–º–µ—Å—Ç–æ mmol/L.

### –†–µ—à–µ–Ω–∏–µ
–ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –í–°–ï BG-–∑–Ω–∞—á–µ–Ω–∏—è –≤ —Å—Ç—Ä–æ–∫–∞—Ö `reason`:

```swift
let minPredBGConverted = convertBG(minPredBG, profile: profile)
let minGuardBGConverted = convertBG(minGuardBG, profile: profile)
reason = "minPredBG: \(String(format: "%.1f", minPredBGConverted)), " +
         "minGuardBG: \(String(format: "%.1f", minGuardBGConverted))"
```

---

## ‚úÖ –ü–õ–ê–ù –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1 (–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π)
1. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ `outUnits: String` –≤ `ProfileResult`
2. ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é `convertBG(_ value: Double, profile: ProfileResult) -> Double`
3. ‚úÖ –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ BG-–∑–Ω–∞—á–µ–Ω–∏—è –≤ `DetermineBasalResult` –ø–µ—Ä–µ–¥ –≤–æ–∑–≤—Ä–∞—Ç–æ–º

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2 (–í—ã—Å–æ–∫–∏–π)
4. ‚úÖ –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –∑–Ω–∞—á–µ–Ω–∏—è –≤ `predBGs` –º–∞—Å—Å–∏–≤–∞—Ö
5. ‚úÖ –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ BG-–∑–Ω–∞—á–µ–Ω–∏—è –≤ —Å—Ç—Ä–æ–∫–∞—Ö `reason`
6. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å unit tests –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ mg/dL ‚Üî mmol/L

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3 (–°—Ä–µ–¥–Ω–∏–π)
7. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å–µ –º–µ—Å—Ç–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è BG-–∑–Ω–∞—á–µ–Ω–∏–π –≤ –¥—Ä—É–≥–∏—Ö –∞–ª–≥–æ—Ä–∏—Ç–º–∞—Ö (IOB, Meal, Autosens)
8. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –µ–¥–∏–Ω–∏—Ü –∏–∑–º–µ—Ä–µ–Ω–∏—è –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
9. ‚úÖ –°–æ–∑–¥–∞—Ç—å —Å—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã Swift vs JavaScript –¥–ª—è mmol/L –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

---

## üß™ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï

### –¢–µ—Å—Ç-–∫–µ–π—Å—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

#### –¢–µ—Å—Ç 1: mg/dL –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
```swift
// Input: BG = 120 mg/dL, profile.outUnits = "mg/dL"
// Expected: –≤—Å–µ –∑–Ω–∞—á–µ–Ω–∏—è –æ—Å—Ç–∞—é—Ç—Å—è –≤ mg/dL, –æ–∫—Ä—É–≥–ª–µ–Ω—ã –¥–æ —Ü–µ–ª—ã—Ö
// eventualBG = 120, minPredBG = 115, etc.
```

#### –¢–µ—Å—Ç 2: mmol/L –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
```swift
// Input: BG = 120 mg/dL (–≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–µ), profile.outUnits = "mmol/L"
// Expected: –≤—Å–µ –∑–Ω–∞—á–µ–Ω–∏—è –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –≤ mmol/L, –æ–∫—Ä—É–≥–ª–µ–Ω—ã –¥–æ 1 –∑–Ω–∞–∫–∞
// eventualBG = 6.7, minPredBG = 6.4, etc.
```

#### –¢–µ—Å—Ç 3: –°—Ç—Ä–æ–∫–∞ reason
```swift
// Input: minPredBG = 100 mg/dL, profile.outUnits = "mmol/L"
// Expected: reason —Å–æ–¥–µ—Ä–∂–∏—Ç "minPredBG: 5.6" (–Ω–µ "minPredBG: 100")
```

#### –¢–µ—Å—Ç 4: Prediction arrays
```swift
// Input: IOBpredBGs = [120, 115, 110, ...], profile.outUnits = "mmol/L"
// Expected: JSON —Å–æ–¥–µ—Ä–∂–∏—Ç "IOB": [7, 6, 6, ...] (–Ω–µ [120, 115, 110, ...])
```

---

## üìä –°–¢–ê–¢–ò–°–¢–ò–ö–ê –û–®–ò–ë–û–ö

- **–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å**: üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø (–º–µ–¥–∏—Ü–∏–Ω—Å–∫–æ–µ –ü–û)
- **–ó–∞—Ç—Ä–æ–Ω—É—Ç—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏**: –í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ mmol/L (–ï–≤—Ä–æ–ø–∞, –ê–≤—Å—Ç—Ä–∞–ª–∏—è, –∏ –¥—Ä.)
- **–ü—Ä–æ—Ü–µ–Ω—Ç –∫–æ–¥–∞ —Å –æ—à–∏–±–∫–æ–π**: ~30% (–≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏, —Ä–∞–±–æ—Ç–∞—é—â–∏–µ —Å BG)
- **–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–µ—Å—Ç –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è**: 50+ —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞

---

## üí° –ü–û–ß–ï–ú–£ –≠–¢–û –ù–ï –†–ê–ë–û–¢–ê–õ–û

1. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ mmol/L –≤–∏–¥–µ–ª–∏ –∑–Ω–∞—á–µ–Ω–∏—è –≤ 18 —Ä–∞–∑ –±–æ–ª—å—à–µ** (120 mg/dL –≤–º–µ—Å—Ç–æ 6.7 mmol/L)
2. **–ê–ª–≥–æ—Ä–∏—Ç–º –ø—Ä–∏–Ω–∏–º–∞–ª –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è** –∏–∑-–∑–∞ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏–∏ —Ü–µ–ª–µ–≤—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π
3. **–ì—Ä–∞—Ñ–∏–∫–∏ –±—ã–ª–∏ –Ω–µ—á–∏—Ç–∞–µ–º—ã–º–∏** (—à–∫–∞–ª–∞ 0-400 –≤–º–µ—Å—Ç–æ 0-22)
4. **–õ–æ–≥–∏ –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –±—ã–ª–∏ –±–µ—Å—Å–º—ã—Å–ª–µ–Ω–Ω—ã–º–∏** –¥–ª—è mmol/L –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

---

## üîó –°–°–´–õ–ö–ò –ù–ê –ò–°–•–û–î–ù–´–ô –ö–û–î

- `lib/determine-basal/determine-basal.js:39-49` - —Ñ—É–Ω–∫—Ü–∏—è `convert_bg`
- `lib/determine-basal/determine-basal.js:806-818` - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `convert_bg` –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö
- `lib/profile/index.js:153` - —É—Å—Ç–∞–Ω–æ–≤–∫–∞ `profile.out_units`

---

**–í—ã–≤–æ–¥**: Swift-–ø–æ—Ä—Ç–∞—Ü–∏—è **–Ω–µ –º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –¥–ª—è mmol/L –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π** –±–µ–∑ —ç—Ç–∏—Ö –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π. –≠—Ç–æ –æ–±—ä—è—Å–Ω—è–µ—Ç, –ø–æ—á–µ–º—É "–Ω–∏—á–µ–≥–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–ª–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ".
