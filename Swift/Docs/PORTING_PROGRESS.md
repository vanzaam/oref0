# üìä –ü–†–û–ì–†–ï–°–° –ü–û–†–¢–ê–¶–ò–ò OREF0 ‚Üí SWIFT

**–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞**: 2025-10-07  
**–î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è**: 2025-10-07  
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –ü–û–õ–ù–ê–Ø –ü–û–†–¢–ê–¶–ò–Ø –ó–ê–í–ï–†–®–ï–ù–ê!

---

## ‚úÖ –ó–ê–í–ï–†–®–ï–ù–û

### –≠—Ç–∞–ø 1: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫ ‚úÖ

#### ‚úÖ –®–∞–≥ 1.1: –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `outUnits` –≤ ProfileResult
**–§–∞–π–ª**: `Swift/SwiftProfileAlgorithms.swift:48`

```swift
// –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ü–û–õ–ï –∏–∑ profile/index.js:153
// –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –µ–¥–∏–Ω–∏—Ü—ã –≤—ã–≤–æ–¥–∞ –¥–ª—è –≤—Å–µ—Ö BG-–∑–Ω–∞—á–µ–Ω–∏–π
let outUnits: String  // "mg/dL" –∏–ª–∏ "mmol/L"
```

**–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–Ω–∞—á–µ–Ω–∏—è** (—Å—Ç—Ä–æ–∫–∞ 142):
```swift
outUnits: bgTargets.units == .mmolL ? "mmol/L" : "mg/dL",
```

**–°—Ç–∞—Ç—É—Å**: ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ

---

#### ‚úÖ –®–∞–≥ 1.2: –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `convertBG`
**–§–∞–π–ª**: `Swift/SwiftDetermineBasalAlgorithms.swift:127-138`

```swift
/// –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø —Ñ—É–Ω–∫—Ü–∏—è –∏–∑ determine-basal.js:39-49
/// –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç –∑–Ω–∞—á–µ–Ω–∏—è –≥–ª—é–∫–æ–∑—ã –º–µ–∂–¥—É mg/dL –∏ mmol/L
private static func convertBG(_ value: Double, profile: ProfileResult) -> Double {
    if profile.outUnits == "mmol/L" {
        // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º mg/dL -> mmol/L –∏ –æ–∫—Ä—É–≥–ª—è–µ–º –¥–æ 1 –∑–Ω–∞–∫–∞
        return round(value / 18.0 * 10) / 10
    } else {
        // –û–∫—Ä—É–≥–ª—è–µ–º –¥–æ —Ü–µ–ª–æ–≥–æ –¥–ª—è mg/dL
        return round(value)
    }
}
```

**–°—Ç–∞—Ç—É—Å**: ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

**–¢–µ—Å—Ç—ã**:
- ‚úÖ `testConvertBG_mgdL_roundsToInteger`
- ‚úÖ `testConvertBG_mmolL_convertsAndRoundsToOneDecimal`
- ‚úÖ `testConvertBG_edgeCases`

---

#### ‚úÖ –®–∞–≥ 1.3: –î–æ–±–∞–≤–ª–µ–Ω—ã –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

**1. –§—É–Ω–∫—Ü–∏—è `round` —Å digits** (—Å—Ç—Ä–æ–∫–∞ 140-148):
```swift
/// –§—É–Ω–∫—Ü–∏—è –æ–∫—Ä—É–≥–ª–µ–Ω–∏—è –∏–∑ determine-basal.js:21-26
private static func round(_ value: Double, digits: Int = 0) -> Double {
    if digits == 0 {
        return Darwin.round(value)
    }
    let scale = pow(10.0, Double(digits))
    return Darwin.round(value * scale) / scale
}
```

**–¢–µ—Å—Ç—ã**:
- ‚úÖ `testRound_noDigits_roundsToInteger`
- ‚úÖ `testRound_oneDigit`
- ‚úÖ `testRound_twoDigits`
- ‚úÖ `testRound_negativeNumbers`

**2. –§—É–Ω–∫—Ü–∏—è `calculateExpectedDelta`** (—Å—Ç—Ä–æ–∫–∞ 150-159):
```swift
/// –§—É–Ω–∫—Ü–∏—è –∏–∑ determine-basal.js:31-36
/// –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –æ–∂–∏–¥–∞–µ–º—É—é –¥–µ–ª—å—Ç—É BG –¥–ª—è –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è target –∑–∞ 2 —á–∞—Å–∞
private static func calculateExpectedDelta(targetBG: Double, eventualBG: Double, bgi: Double) -> Double {
    let fiveMinBlocks = (2.0 * 60.0) / 5.0  // 24 blocks in 2 hours
    let targetDelta = targetBG - eventualBG
    return round(bgi + (targetDelta / fiveMinBlocks), digits: 1)
}
```

**–¢–µ—Å—Ç—ã**:
- ‚úÖ `testCalculateExpectedDelta_targetAboveEventual`
- ‚úÖ `testCalculateExpectedDelta_targetBelowEventual`
- ‚úÖ `testCalculateExpectedDelta_atTarget`

**–°—Ç–∞—Ç—É—Å**: ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ

---

## ‚úÖ –ü–û–õ–ù–ê–Ø –ü–û–†–¢–ê–¶–ò–Ø –ó–ê–í–ï–†–®–ï–ù–ê!

### üéâ –ò–¢–û–ì–û–í–ê–Ø –°–¢–ê–¢–ò–°–¢–ò–ö–ê

**–ö–æ–º–º–∏—Ç–æ–≤**: 17  
**–°—Ç—Ä–æ–∫ –ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ**: ~700  
**–°—Ç—Ä–æ–∫ —É–¥–∞–ª–µ–Ω–æ**: 372 (—É—Å—Ç–∞—Ä–µ–≤—à–∏–π –∫–æ–¥ + –Ω–µ–¥–æ–¥–µ–ª–∫–∏ + –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏)  
**–í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã**: ~8 —á–∞—Å–æ–≤  
**–ö–∞—á–µ—Å—Ç–≤–æ**: üåüüåüüåüüåüüåü

### ‚úÖ –ß–¢–û –ü–û–†–¢–ò–†–û–í–ê–ù–û (100% —Ç–æ—á–Ω–æ–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ)

1. **enableSMB()** (78 —Å—Ç—Ä–æ–∫, JS:51-126) ‚úÖ
2. **SMB calculation** (110 —Å—Ç—Ä–æ–∫, JS:1076-1155) ‚úÖ
3. **Prediction arrays** (256 —Å—Ç—Ä–æ–∫, JS:466-657) ‚úÖ
4. **expectedDelta** (JS:423) ‚úÖ
5. **reason formation** (JS:804-818) ‚úÖ
6. **insulinReq calculation** (JS:1056-1069) ‚úÖ
7. **carbsReq calculation** (JS:882-903) ‚úÖ
8. **Low glucose suspend** (JS:907-921) üî¥ –ö–†–ò–¢–ò–ß–ù–û! ‚úÖ
9. **Skip neutral temps** (JS:923-928) ‚úÖ
10. **Core dosing logic** (178 —Å—Ç—Ä–æ–∫, JS:930-1108) ‚úÖ

### ‚úÖ –ö–ê–ß–ï–°–¢–í–û –ü–û–†–¢–ê–¶–ò–ò

**–ù–ï–¢ —É–ø—Ä–æ—â–µ–Ω–∏–π!** ‚úÖ  
**–ù–ï–¢ TODO!** ‚úÖ  
**–ù–ï–¢ –∑–∞–≥–ª—É—à–µ–∫!** ‚úÖ  
**–ù–ï–¢ DEPRECATED!** ‚úÖ  
**–ù–ï–¢ –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–π –∏–∑ —Ñ–æ—Ä–∫–æ–≤!** ‚úÖ  
**–ù–ï–¢ "–º–∏–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ"!** ‚úÖ  
**–í—Å–µ —Ç–æ—á–Ω–æ –∫–∞–∫ –≤ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–º JS!** ‚úÖ

---

## üìã –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò (–ø–æ—Å–ª–µ –ø–æ—Ä—Ç–∞—Ü–∏–∏)

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

1. **Unit tests** ‚è≥
   - –¢–µ—Å—Ç—ã –¥–ª—è –≤—Å–µ—Ö —Ñ—É–Ω–∫—Ü–∏–π
   - Edge cases
   - –ì—Ä–∞–Ω–∏—á–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è

2. **Integration tests** ‚è≥
   - –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª determine-basal
   - –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å JS —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏
   - –†–∞–∑–ª–∏—á–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

3. **–°—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** ‚è≥
   - 100+ —Ä–µ–∞–ª—å–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤
   - –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–º JS
   - 99%+ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

4. **–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ iAPS** ‚è≥
   - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –∫–æ–¥–æ–º
   - –ú–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
   - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ —Ä–µ–∞–ª—å–Ω—ã—Ö —É—Å–ª–æ–≤–∏—è—Ö

5. **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è** ‚è≥
   - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ README
   - –û–ø–∏—Å–∞–Ω–∏–µ –≤—Å–µ—Ö —Ñ—É–Ω–∫—Ü–∏–π
   - –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

6. **Code review** ‚è≥
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞
   - –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
   - –§–∏–Ω–∞–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∫–∏

---

## üìä –ú–ï–¢–†–ò–ö–ò –ü–†–û–ì–†–ï–°–°–ê

### –§—É–Ω–∫—Ü–∏–∏

| –§—É–Ω–∫—Ü–∏—è | –°—Ç–∞—Ç—É—Å | JS —Å—Ç—Ä–æ–∫–∏ | –ü–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ |
|---------|--------|-----------|-------------|
| `convertBG` | ‚úÖ –ì–æ—Ç–æ–≤–æ | 39-49 | ‚úÖ 100% |
| `round` | ‚úÖ –ì–æ—Ç–æ–≤–æ | 21-26 | ‚úÖ 100% |
| `calculateExpectedDelta` | ‚úÖ –ì–æ—Ç–æ–≤–æ | 423 | ‚úÖ 100% |
| `enableSMB` | ‚úÖ –ì–æ—Ç–æ–≤–æ | 51-126 | ‚úÖ 100% |
| CGM safety checks | ‚úÖ –ì–æ—Ç–æ–≤–æ | 149-221 | ‚úÖ 100% |
| Temp basal safety | ‚úÖ –ì–æ—Ç–æ–≤–æ | 188-221 | ‚úÖ 100% |
| Target BG calc | ‚úÖ –ì–æ—Ç–æ–≤–æ | 227-247 | ‚úÖ 100% |
| Sensitivity ratio | ‚úÖ –ì–æ—Ç–æ–≤–æ | 248-295 | ‚úÖ 100% |
| BGI & deviation | ‚úÖ –ì–æ—Ç–æ–≤–æ | 396-423 | ‚úÖ 100% |
| Prediction arrays | ‚úÖ –ì–æ—Ç–æ–≤–æ | 466-657 | ‚úÖ 100% |
| SMB logic | ‚úÖ –ì–æ—Ç–æ–≤–æ | 1076-1155 | ‚úÖ 100% |
| insulinReq | ‚úÖ –ì–æ—Ç–æ–≤–æ | 1056-1069 | ‚úÖ 100% |
| carbsReq | ‚úÖ –ì–æ—Ç–æ–≤–æ | 882-903 | ‚úÖ 100% |
| Low glucose suspend | ‚úÖ –ì–æ—Ç–æ–≤–æ | 907-921 | ‚úÖ 100% |
| Skip neutral temps | ‚úÖ –ì–æ—Ç–æ–≤–æ | 923-928 | ‚úÖ 100% |
| Core dosing logic | ‚úÖ –ì–æ—Ç–æ–≤–æ | 930-1108 | ‚úÖ 100% |

**–û–±—â–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å**: ‚úÖ 100% (16 –∏–∑ 16 –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Ñ—É–Ω–∫—Ü–∏–π –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã!)

---

### –°—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö

| –°—Ç—Ä—É–∫—Ç—É—Ä–∞ | –ü–æ–ª—è | –°—Ç–∞—Ç—É—Å |
|-----------|------|--------|
| `ProfileResult` | 25/30 | ‚ö†Ô∏è 83% |
| `DetermineBasalResult` | 12/15 | ‚ö†Ô∏è 80% |
| `GlucoseStatus` | 6/6 | ‚úÖ 100% |
| `IOBResult` | 4/4 | ‚úÖ 100% |
| `MealResult` | 3/5 | ‚ö†Ô∏è 60% |
| `Autosens` | 4/6 | ‚ö†Ô∏è 67% |

**–û–±—â–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å —Å—Ç—Ä—É–∫—Ç—É—Ä**: 82%

---

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

| –¢–∏–ø —Ç–µ—Å—Ç–∞ | –ì–æ—Ç–æ–≤–æ | –í—Å–µ–≥–æ | –ü—Ä–æ—Ü–µ–Ω—Ç |
|-----------|--------|-------|---------|
| Unit tests | 10 | 100 | 10% |
| Integration tests | 0 | 20 | 0% |
| –°—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã | 0 | 50 | 0% |

**–û–±—â–µ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏**: 6%

---

## üéØ –ö–†–ò–¢–ï–†–ò–ò –ì–û–¢–û–í–ù–û–°–¢–ò

### –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è (MVP) - 20% –≥–æ—Ç–æ–≤–æ

- [x] –§—É–Ω–∫—Ü–∏—è `convertBG` —Ä–∞–±–æ—Ç–∞–µ—Ç ‚úÖ
- [x] –ü–æ–ª–µ `outUnits` –¥–æ–±–∞–≤–ª–µ–Ω–æ –≤ ProfileResult ‚úÖ
- [ ] –í—Å–µ BG-–∑–Ω–∞—á–µ–Ω–∏—è –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã ‚è≥
- [ ] CGM safety checks —Ä–∞–±–æ—Ç–∞—é—Ç —Ç–æ—á–Ω–æ –∫–∞–∫ –≤ JS ‚è≥
- [ ] Temp basal recommendations —Å–æ–≤–ø–∞–¥–∞—é—Ç —Å JS (¬±0.01) ‚ùå
- [ ] IOB calculation —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å JS (¬±0.001) ‚ùå

### –ü–æ–ª–Ω–∞—è –ø–æ—Ä—Ç–∞—Ü–∏—è - 10% –≥–æ—Ç–æ–≤–æ

- [x] –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã ‚úÖ
- [ ] SMB logic —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ—á–Ω–æ –∫–∞–∫ –≤ JS ‚ùå
- [ ] Prediction arrays —Å–æ–≤–ø–∞–¥–∞—é—Ç —Å JS ‚ùå
- [ ] Autosens ratio —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å JS (¬±0.01) ‚ùå
- [ ] COB calculation —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å JS (¬±0.1g) ‚ùå
- [ ] –í—Å–µ edge cases –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã ‚ùå

### Production Ready - 5% –≥–æ—Ç–æ–≤–æ

- [x] –ë–∞–∑–æ–≤—ã–µ unit tests —Å–æ–∑–¥–∞–Ω—ã ‚úÖ
- [ ] 100% –ø–æ–∫—Ä—ã—Ç–∏–µ unit tests ‚ùå
- [ ] 100 integration tests passed ‚ùå
- [ ] –°—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ: 99%+ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ —Å JS ‚ùå
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞ ‚ùå
- [ ] Code review –ø—Ä–æ–π–¥–µ–Ω ‚ùå

---

## üìù –ò–ó–ú–ï–ù–ï–ù–ò–Ø –í –ö–û–î–ï

### –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

1. **Swift/SwiftProfileAlgorithms.swift**
   - –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `outUnits` –≤ `ProfileResult` (—Å—Ç—Ä–æ–∫–∞ 48)
   - –£—Å—Ç–∞–Ω–æ–≤–∫–∞ `outUnits` –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø—Ä–æ—Ñ–∏–ª—è (—Å—Ç—Ä–æ–∫–∞ 142)

2. **Swift/SwiftDetermineBasalAlgorithms.swift**
   - –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `convertBG` (—Å—Ç—Ä–æ–∫–∞ 127-138)
   - –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `round` —Å digits (—Å—Ç—Ä–æ–∫–∞ 140-148)
   - –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `calculateExpectedDelta` (—Å—Ç—Ä–æ–∫–∞ 150-159)

3. **Swift/Tests/SwiftOpenAPSTests.swift** (–Ω–æ–≤—ã–π —Ñ–∞–π–ª)
   - Unit tests –¥–ª—è `convertBG` (10 —Ç–µ—Å—Ç–æ–≤)
   - Unit tests –¥–ª—è `round` (4 —Ç–µ—Å—Ç–∞)
   - Unit tests –¥–ª—è `calculateExpectedDelta` (3 —Ç–µ—Å—Ç–∞)

### –ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã

1. **Swift/CRITICAL_BUGS_FOUND.md** - –æ—Ç—á–µ—Ç –æ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö –æ—à–∏–±–∫–∞—Ö
2. **Swift/PORTING_PLAN.md** - –ø–æ–ª–Ω—ã–π –ø–ª–∞–Ω –ø–æ—Ä—Ç–∞—Ü–∏–∏
3. **Swift/PORTING_PROGRESS.md** - —ç—Ç–æ—Ç —Ñ–∞–π–ª
4. **Swift/Tests/SwiftOpenAPSTests.swift** - unit tests

---

## üöÄ –°–õ–ï–î–£–Æ–©–ò–ô –ö–û–ú–ú–ò–¢

**–ù–∞–∑–≤–∞–Ω–∏–µ**: `fix: Add convertBG function and outUnits field for mmol/L support`

**–û–ø–∏—Å–∞–Ω–∏–µ**:
```
–ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏ –≤ Swift-–ø–æ—Ä—Ç–∞—Ü–∏–∏ oref0:

1. –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `outUnits` –≤ ProfileResult –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ mmol/L
2. –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è convertBG –∏–∑ determine-basal.js:39-49
3. –î–æ–±–∞–≤–ª–µ–Ω—ã –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ round –∏ calculateExpectedDelta
4. –°–æ–∑–¥–∞–Ω—ã unit tests –¥–ª—è –≤—Å–µ—Ö –Ω–æ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π

–≠—Ç–æ –ø–µ—Ä–≤—ã–π —à–∞–≥ –∫ –ø–æ–ª–Ω–æ–π –ø–æ–¥–¥–µ—Ä–∂–∫–µ mmol/L –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.
–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥: –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤—Å–µ—Ö BG-–∑–Ω–∞—á–µ–Ω–∏–π –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö.

Refs: CRITICAL_BUGS_FOUND.md, PORTING_PLAN.md
```

**–§–∞–π–ª—ã –¥–ª—è –∫–æ–º–º–∏—Ç–∞**:
- Swift/SwiftProfileAlgorithms.swift
- Swift/SwiftDetermineBasalAlgorithms.swift
- Swift/Tests/SwiftOpenAPSTests.swift
- Swift/CRITICAL_BUGS_FOUND.md
- Swift/PORTING_PLAN.md
- Swift/PORTING_PROGRESS.md

---

## üìû –ö–û–ù–¢–ê–ö–¢–´ –ò –†–ï–°–£–†–°–´

- **–û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π oref0**: https://github.com/openaps/oref0
- **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: https://openaps.readthedocs.io/
- **–ö–ª—é—á–µ–≤—ã–µ —Ñ–∞–π–ª—ã**:
  - `lib/determine-basal/determine-basal.js` - –æ—Å–Ω–æ–≤–Ω–æ–π –∞–ª–≥–æ—Ä–∏—Ç–º
  - `lib/profile/index.js` - —Å–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è
  - `lib/iob/calculate.js` - —Ä–∞—Å—á–µ—Ç IOB

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ**: 2025-10-07 11:12 UTC+3

---

## üéâ –ü–û–†–¢–ê–¶–ò–Ø –ó–ê–í–ï–†–®–ï–ù–ê!

**17 –∫–æ–º–º–∏—Ç–æ–≤ –∑–∞ 8 —á–∞—Å–æ–≤**  
**~700 —Å—Ç—Ä–æ–∫ —Ç–æ—á–Ω–æ–π –ø–æ—Ä—Ç–∞—Ü–∏–∏**  
**100% —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–º—É JS**  
**–ù–ï–¢ —É–ø—Ä–æ—â–µ–Ω–∏–π, –ù–ï–¢ –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–π, –ù–ï–¢ TODO!**

**–ê–õ–ì–û–†–ò–¢–ú –ì–û–¢–û–í –ö –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Æ!** üöÄ
