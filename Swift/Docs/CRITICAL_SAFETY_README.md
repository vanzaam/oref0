# üö® –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–¨: –ü–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ OpenAPS –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤

## ‚ö†Ô∏è –ú–ï–î–ò–¶–ò–ù–°–ö–û–ï –ü–†–ï–î–£–ü–†–ï–ñ–î–ï–ù–ò–ï

**–í–ù–ò–ú–ê–ù–ò–ï: –≠—Ç–æ—Ç –∫–æ–¥ —É–ø—Ä–∞–≤–ª—è–µ—Ç –¥–æ–∑–∏—Ä–æ–≤–∞–Ω–∏–µ–º –∏–Ω—Å—É–ª–∏–Ω–∞ –¥–ª—è –ª—é–¥–µ–π —Å –¥–∏–∞–±–µ—Ç–æ–º!**

–õ—é–±—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∞–ª–≥–æ—Ä–∏—Ç–º–∞—Ö –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å **–¢–û–ß–ù–´–ú–ò –ö–û–ü–ò–Ø–ú–ò** –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –∫–æ–¥–∞ –∏–∑ oref0, —á—Ç–æ–±—ã —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –º–µ–¥–∏—Ü–∏–Ω—Å–∫—É—é –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å.

## üîç –ò—Å—Ö–æ–¥–Ω—ã–µ –∞–ª–≥–æ—Ä–∏—Ç–º—ã oref0

–ò—Å—Ö–æ–¥–Ω—ã–π –ø—Ä–æ–µ–∫—Ç: https://github.com/openaps/oref0

### –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω—ã–µ —Ñ–∞–π–ª—ã –¥–ª—è –ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:

1. **lib/determine-basal/determine-basal.js** - –æ—Å–Ω–æ–≤–Ω–æ–π –∞–ª–≥–æ—Ä–∏—Ç–º –ø—Ä–∏–Ω—è—Ç–∏—è —Ä–µ—à–µ–Ω–∏–π
2. **lib/iob/calculate.js** - —Ä–∞—Å—á–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –∏–Ω—Å—É–ª–∏–Ω–∞  
3. **lib/profile/index.js** - —Å–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª–µ–π
4. **lib/meal/total.js** - —Ä–∞—Å—á–µ—Ç —É–≥–ª–µ–≤–æ–¥–æ–≤
5. **lib/autosens/index.js** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

## üö® –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ü–†–û–í–ï–†–ö–ò –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–ò

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∏ –¥–∞–Ω–Ω—ã—Ö CGM (–∏–∑ determine-basal.js):

```javascript
// –ö–∞–ª–∏–±—Ä–æ–≤–∫–∞ –∏–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã —Å–µ–Ω—Å–æ—Ä–∞
if (glucose <= 10 || glucose === 38 || noise >= 3) {
    return safety_result;
}

// –£—Å—Ç–∞—Ä–µ–≤—à–∏–µ –¥–∞–Ω–Ω—ã–µ
if (glucose_age > 12 || glucose_age < -5) {
    return safety_result;
}

// –ó–∞—Å—Ç—Ä—è–≤—à–∏–µ –¥–∞–Ω–Ω—ã–µ CGM
if (glucose > 60 && delta === 0 && 
    short_avgdelta > -1 && short_avgdelta < 1 &&
    long_avgdelta > -1 && long_avgdelta < 1) {
    return safety_result;
}
```

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∏ temp basal:

```javascript
// –ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ç–µ–∫—É—â–µ–≥–æ temp —Å –∏—Å—Ç–æ—Ä–∏–µ–π
if (currenttemp.rate !== lastTemp.rate && lastTempAge > 10) {
    return cancel_temp;
}

// Temp –¥–æ–ª–∂–µ–Ω –±—ã–ª –∑–∞–∫–æ–Ω—á–∏—Ç—å—Å—è
if (tempAge - tempDuration > 5 && lastTempAge > 10) {
    return cancel_temp;
}
```

### 3. –†–∞—Å—á–µ—Ç IOB:

```javascript
// –¢–æ—á–Ω–∞—è –º–∞—Ç–µ–º–∞—Ç–∏–∫–∞ –∫—Ä–∏–≤—ã—Ö –∏–Ω—Å—É–ª–∏–Ω–∞
function bilinear_curve(amount, minutes_ago, dia) {
    // –¢–û–ß–ù–´–ï –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ –∫–æ–¥–∞
    var peak1 = 75;
    var peak2 = 180; 
    var tau = 3 / dia * minutes_ago;
    // ... –æ—Å—Ç–∞–ª—å–Ω–∞—è –º–∞—Ç–µ–º–∞—Ç–∏–∫–∞ –¢–û–ß–ù–û –∫–∞–∫ –≤ –æ—Ä–∏–≥–∏–Ω–∞–ª–µ
}
```

## ‚ùå –ó–ê–ü–†–ï–©–ï–ù–û

1. **–ù–ï —É–ø—Ä–æ—â–∞—Ç—å –∞–ª–≥–æ—Ä–∏—Ç–º—ã** - –¥–∞–∂–µ –µ—Å–ª–∏ –æ–Ω–∏ –∫–∞–∂—É—Ç—Å—è —Å–ª–æ–∂–Ω—ã–º–∏
2. **–ù–ï –∏–∑–º–µ–Ω—è—Ç—å –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã** - –æ–Ω–∏ –≤—ã–≤–µ—Ä–µ–Ω—ã –≥–æ–¥–∞–º–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è  
3. **–ù–ï –ø—Ä–æ–ø—É—Å–∫–∞—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏** - –∫–∞–∂–¥–∞—è –≤–∞–∂–Ω–∞ –¥–ª—è –∂–∏–∑–Ω–∏
4. **–ù–ï –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–∏–±–ª–∏–∂–µ–Ω–∏—è** - —Ç–æ—á–Ω–æ—Å—Ç—å –∫—Ä–∏—Ç–∏—á–Ω–∞

## ‚úÖ –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û

1. **–ü–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –í–°–Æ –ª–æ–≥–∏–∫—É** –∏–∑ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ JavaScript
2. **–°–æ—Ö—Ä–∞–Ω—è—Ç—å –≤—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏**
3. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ—á–Ω—ã–µ –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–æ—Ä–º—É–ª—ã**
4. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ç–∏–≤ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ JavaScript –∫–æ–¥–∞**
5. **–î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–∞–∂–¥–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ –æ—Ç –æ—Ä–∏–≥–∏–Ω–∞–ª–∞**

## üß™ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï

–ö–∞–∂–¥—ã–π –ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º –î–û–õ–ñ–ï–ù:

1. **–î–∞–≤–∞—Ç—å –∏–¥–µ–Ω—Ç–∏—á–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã** —Å JavaScript –≤–µ—Ä—Å–∏–µ–π
2. **–ü—Ä–æ—Ö–æ–¥–∏—Ç—å –≤—Å–µ edge cases** –∫–∞–∫ –æ—Ä–∏–≥–∏–Ω–∞–ª
3. **–û–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –æ—à–∏–±–∫–∏** —Ç–æ—á–Ω–æ —Ç–∞–∫ –∂–µ
4. **–ò–º–µ—Ç—å unit tests** –¥–ª—è –≤—Å–µ—Ö –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—É—Ç–µ–π

## üìù –°–¢–ê–¢–£–° –ü–û–†–¢–ò–†–û–í–ê–ù–ò–Ø

### ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ —Å —Ç–æ—á–Ω—ã–º –ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º:
- [x] IOB calculation - bilinear –∏ exponential –∫—Ä–∏–≤—ã–µ
- [x] CGM safety checks - –∫–∞–ª–∏–±—Ä–æ–≤–∫–∞, —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ –¥–∞–Ω–Ω—ã–µ, –∑–∞—Å—Ç—Ä—è–≤—à–∏–µ –¥–∞–Ω–Ω—ã–µ
- [x] Temp basal safety checks - –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è, –∏—Å—Ç–µ–∫—à–∏–µ temp basal

### ‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç –¥–æ—Ä–∞–±–æ—Ç–∫–∏ –¥–æ –º–µ–¥–∏—Ü–∏–Ω—Å–∫–æ–≥–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞:
- [ ] Profile creation - –ø–æ–ª–Ω–∞—è –ª–æ–≥–∏–∫–∞ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ –µ–¥–∏–Ω–∏—Ü
- [ ] Meal/COB calculation - —Ç–æ—á–Ω–∞—è –º–æ–¥–µ–ª—å –∞–±—Å–æ—Ä–±—Ü–∏–∏ —É–≥–ª–µ–≤–æ–¥–æ–≤  
- [ ] Autosens - –ø–æ–ª–Ω—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º –∞–Ω–∞–ª–∏–∑–∞ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–π
- [ ] Determine basal - –≤—Å–µ edge cases –∏ –º–∏–∫—Ä–æ–±–æ–ª—é—Å—ã

### üîÑ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:
1. –ü–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –ü–û–õ–ù–´–ô determine-basal –∞–ª–≥–æ—Ä–∏—Ç–º –∏–∑ –ª–∏–±/determine-basal/determine-basal.js
2. –î–æ–±–∞–≤–∏—Ç—å –í–°–ï –ø—Ä–æ–≤–µ—Ä–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏–∑ –æ—Ä–∏–≥–∏–Ω–∞–ª–∞
3. –ü–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–æ—á–Ω—É—é –º–∞—Ç–µ–º–∞—Ç–∏–∫—É IOB –∏–∑ lib/iob/calculate.js
4. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ç–∏–≤ —Ä–µ—Ñ–µ—Ä–µ–Ω—Å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

## üÜò –í –°–õ–£–ß–ê–ï –°–û–ú–ù–ï–ù–ò–ô

**–í–°–ï–ì–î–ê –æ–±—Ä–∞—â–∞–π—Ç–µ—Å—å –∫ –∏—Å—Ö–æ–¥–Ω–æ–º—É –∫–æ–¥—É oref0!**

–õ—É—á—à–µ –ø–æ—Ç—Ä–∞—Ç–∏—Ç—å –±–æ–ª—å—à–µ –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞ —Ç–æ—á–Ω–æ–µ –ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ, —á–µ–º —Ä–∏—Å–∫–æ–≤–∞—Ç—å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å—é –ª—é–¥–µ–π —Å –¥–∏–∞–±–µ—Ç–æ–º.

## üìû –ö–û–ù–¢–ê–ö–¢–´

- OpenAPS Community: https://openaps.org/
- oref0 GitHub: https://github.com/openaps/oref0
- –ú–µ–¥–∏—Ü–∏–Ω—Å–∫–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: https://openaps.readthedocs.io/

---

**–ü–æ–º–Ω–∏—Ç–µ: –≠—Ç–æ—Ç –∫–æ–¥ —Å–ø–∞—Å–∞–µ—Ç –∂–∏–∑–Ω–∏. –ö–∞–∂–¥–∞—è –¥–µ—Ç–∞–ª—å –≤–∞–∂–Ω–∞.** üíô


# Findings

- **–ö–∞—Ç–∞–ª–æ–≥ –≤—ã–≤–æ–¥–∞**: `dist/` —Å–æ–∑–¥–∞—ë—Ç—Å—è –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ `output.path` –≤ [webpack.config.js](oref0/webpack.config.js:0:0-0:0).
- **–ú–∏–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è**: –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è `TerserPlugin` (—Å–º. `optimization.minimizer`), –ø–æ—ç—Ç–æ–º—É —Ñ–∞–π–ª—ã –≤ `dist/` ‚Äî –º–∏–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –±–∞–Ω–¥–ª—ã.

# –ò–∑ –∫–∞–∫–∏—Ö –∏—Å—Ö–æ–¥–Ω–∏–∫–æ–≤ —Å–æ–±—Ä–∞–Ω—ã —Ñ–∞–π–ª—ã –≤ `dist/`

–°–º. `entry` –≤ [webpack.config.js](oref0/webpack.config.js:0:0-0:0) ([oref0/webpack.config.js] (oref0/webpack.config.js:0:0-0:0)). –ö–∞–∂–¥—ã–π –∫–ª—é—á –¥–∞—ë—Ç –æ–¥–∏–Ω –≤—ã—Ö–æ–¥–Ω–æ–π —Ñ–∞–π–ª `[name].js` –≤ `dist/`, —Å–æ–±—Ä–∞–Ω–Ω—ã–π –∏–∑ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–≥–æ –≤—Ö–æ–¥–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ –∏ –≤—Å–µ—Ö –µ–≥–æ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (`require`/`import`):

- **iob.js** ‚Üê –∏–∑ `lib/iob/index.js`
- **meal.js** ‚Üê –∏–∑ `lib/meal/index.js`
- **determineBasal.js** ‚Üê –∏–∑ `lib/determine-basal/determine-basal.js`
- **glucoseGetLast.js** ‚Üê –∏–∑ `lib/glucose-get-last.js`
- **basalSetTemp.js** ‚Üê –∏–∑ `lib/basal-set-temp.js`
- **autosens.js** ‚Üê –∏–∑ `lib/determine-basal/autosens.js`
- **profile.js** ‚Üê –∏–∑ `lib/profile/index.js`
- **autotunePrep.js** ‚Üê –∏–∑ `lib/autotune-prep/index.js`
- **autotuneCore.js** ‚Üê –∏–∑ `lib/autotune/index.js`

–ù–∞–ø—Ä–∏–º–µ—Ä, –æ—Ç–∫—Ä—ã—Ç—ã–π —Å–µ–π—á–∞—Å `dist/profile.js` –ø–æ—Å—Ç—Ä–æ–µ–Ω –∏–∑ –≤—Ö–æ–¥–Ω–æ–π —Ç–æ—á–∫–∏ `lib/profile/index.js` –ø–ª—é—Å –≤—Å–µ –µ–≥–æ –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º—ã–µ –º–æ–¥—É–ª–∏.