# ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –µ–¥–∏–Ω–∏—Ü (mg/dL vs mmol/L)

**–î–∞—Ç–∞**: 2025-10-07 09:36  
**–ü—Ä–æ–±–ª–µ–º–∞**: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è bg, eventualBG –∏ predBGs –º–∞—Å—Å–∏–≤–æ–≤

---

## ‚ùå –ß—Ç–æ –±—ã–ª–æ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ

–Ø –æ—à–∏–±–æ—á–Ω–æ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–ª –í–°–Å –≤ mmol/L, –≤–∫–ª—é—á–∞—è:
- `bg` - –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–ª (–ù–ï–ü–†–ê–í–ò–õ–¨–ù–û!)
- `eventualBG` - –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–ª (–ù–ï–ü–†–ê–í–ò–õ–¨–ù–û!)
- `predBGs` –º–∞—Å—Å–∏–≤—ã - –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–ª (–ù–ï–ü–†–ê–í–ò–õ–¨–ù–û!)

---

## ‚úÖ –ö–∞–∫ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å (—Å–æ–≥–ª–∞—Å–Ω–æ –æ—Ä–∏–≥–∏–Ω–∞–ª—É)

### –ß—Ç–æ –ù–ï –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è (–≤—Å–µ–≥–¥–∞ mg/dL):

1. **`bg`** - –≤—Å–µ–≥–¥–∞ –≤ mg/dL
   ```javascript
   rT.bg = bg;  // NO convert_bg!
   ```

2. **`eventualBG`** - –≤—Å–µ–≥–¥–∞ –≤ mg/dL
   ```javascript
   rT.eventualBG = eventualBG;  // for FreeAPS-X needs to be in mg/dL
   ```
   –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∏–∑ –æ—Ä–∏–≥–∏–Ω–∞–ª–∞ (—Å—Ç—Ä–æ–∫–∞ 698) –ø—Ä—è–º–æ –≥–æ–≤–æ—Ä–∏—Ç: **"needs to be in mg/dL"**!

3. **`predBGs` –º–∞—Å—Å–∏–≤—ã** - –≤—Å–µ–≥–¥–∞ –≤ mg/dL
   ```javascript
   rT.predBGs.IOB = IOBpredBGs;  // NO convert_bg!
   rT.predBGs.COB = COBpredBGs;  // NO convert_bg!
   rT.predBGs.UAM = UAMpredBGs;  // NO convert_bg!
   rT.predBGs.ZT = ZTpredBGs;    // NO convert_bg!
   ```

### –ß—Ç–æ –ö–û–ù–í–ï–†–¢–ò–†–£–ï–¢–°–Ø (–¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é):

1. **`BGI`** - –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è
   ```javascript
   rT.BGI = convert_bg(bgi, profile);  // YES!
   ```

2. **`deviation`** - –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è
   ```javascript
   rT.deviation = convert_bg(deviation, profile);  // YES!
   ```

3. **`ISF`** - –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è
   ```javascript
   rT.ISF = convert_bg(sens, profile);  // YES!
   ```

4. **`target_bg`** - –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è
   ```javascript
   rT.target_bg = convert_bg(target_bg, profile);  // YES!
   ```

5. **–ó–Ω–∞—á–µ–Ω–∏—è –≤ —Å—Ç—Ä–æ–∫–µ `reason`** - –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É—é—Ç—Å—è (–¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è)
   ```javascript
   "minPredBG: " + convert_bg(minPredBG, profile)  // YES!
   ```

---

## üéØ –ü–æ—á–µ–º—É —Ç–∞–∫?

### 1. –ê–ª–≥–æ—Ä–∏—Ç–º —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ mg/dL

–í—Å–µ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è OpenAPS –ø—Ä–æ–∏—Å—Ö–æ–¥—è—Ç –≤ mg/dL. –≠—Ç–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç –∞–ª–≥–æ—Ä–∏—Ç–º–∞.

### 2. Nightscout —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ mg/dL

Nightscout –∏ –¥—Ä—É–≥–∏–µ —Å–∏—Å—Ç–µ–º—ã –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –æ–∂–∏–¥–∞—é—Ç –¥–∞–Ω–Ω—ã–µ –≤ mg/dL. 
`bg`, `eventualBG` –∏ `predBGs` –∏–¥—É—Ç –Ω–∞–ø—Ä—è–º—É—é –≤ Nightscout.

### 3. –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è —Ç–æ–ª—å–∫–æ –¥–ª—è UI

`convert_bg()` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è –∑–Ω–∞—á–µ–Ω–∏–π, –∫–æ—Ç–æ—Ä—ã–µ **–ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é**:
- BGI, deviation, ISF, target_bg - —ç—Ç–æ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –°—Ç—Ä–æ–∫–∞ `reason` - —Ç–µ–∫—Å—Ç –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### 4. predBGs –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–æ–≤

–ú–∞—Å—Å–∏–≤—ã `predBGs` –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –≥—Ä–∞—Ñ–∏–∫–æ–≤ –ø—Ä–æ–≥–Ω–æ–∑–∞.
–ì—Ä–∞—Ñ–∏–∫–∏ —Å—Ç—Ä–æ—è—Ç—Å—è –≤ mg/dL, –∑–∞—Ç–µ–º **UI —Å–∞–º –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç** –∏—Ö –ø—Ä–∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–∏ –µ—Å–ª–∏ –Ω—É–∂–Ω–æ.

---

## üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤ –∫–æ–¥–µ

### –í `rawJSON`:

```swift
// –ë–´–õ–û (–ù–ï–ü–†–ê–í–ò–õ–¨–ù–û):
"bg": \(convertedBG),
"eventualBG": \(convertedEventualBG),
predBGs: –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –º–∞—Å—Å–∏–≤—ã

// –°–¢–ê–õ–û (–ü–†–ê–í–ò–õ–¨–ù–û):
"bg": \(Int(bg.rounded())),           // –í–°–ï–ì–î–ê mg/dL
"eventualBG": \(Int(eventualBG.rounded())),  // –í–°–ï–ì–î–ê mg/dL
predBGs: –º–∞—Å—Å–∏–≤—ã –≤ mg/dL              // –í–°–ï–ì–î–ê mg/dL
```

### –ü–æ–ª—è, –∫–æ—Ç–æ—Ä—ã–µ –ü–†–ê–í–ò–õ–¨–ù–û –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É—é—Ç—Å—è:

```swift
"BGI": \(BGIString),           // ‚úÖ –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è
"deviation": \(deviationString),  // ‚úÖ –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è
"ISF": \(ISFString),           // ‚úÖ –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è
"target_bg": \(targetBGString)    // ‚úÖ –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è
```

---

## üìä –ü—Ä–∏–º–µ—Ä –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ JSON

### –î–ª—è mg/dL –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
```json
{
  "bg": 120,           // mg/dL
  "eventualBG": 100,   // mg/dL
  "BGI": -2,           // mg/dL (–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é)
  "deviation": 5,      // mg/dL (–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é)
  "ISF": 50,           // mg/dL (–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é)
  "target_bg": 100,    // mg/dL (–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é)
  "predBGs": {
    "IOB": [120, 115, 110, ...]  // mg/dL
  }
}
```

### –î–ª—è mmol/L –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
```json
{
  "bg": 120,           // mg/dL (–ù–ï –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è!)
  "eventualBG": 100,   // mg/dL (–ù–ï –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è!)
  "BGI": -0.1,         // mmol/L (–∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
  "deviation": 0.3,    // mmol/L (–∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
  "ISF": 2.8,          // mmol/L (–∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
  "target_bg": 5.6,    // mmol/L (–∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
  "predBGs": {
    "IOB": [120, 115, 110, ...]  // mg/dL (–ù–ï –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è!)
  }
}
```

---

## ‚úÖ –ß—Ç–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Ç–µ–ø–µ—Ä—å

1. ‚úÖ `bg` –≤—Å–µ–≥–¥–∞ –≤ mg/dL (–∫–∞–∫ –≤ –æ—Ä–∏–≥–∏–Ω–∞–ª–µ)
2. ‚úÖ `eventualBG` –≤—Å–µ–≥–¥–∞ –≤ mg/dL (–∫–∞–∫ –≤ –æ—Ä–∏–≥–∏–Ω–∞–ª–µ)
3. ‚úÖ `predBGs` –º–∞—Å—Å–∏–≤—ã –≤—Å–µ–≥–¥–∞ –≤ mg/dL (–∫–∞–∫ –≤ –æ—Ä–∏–≥–∏–Ω–∞–ª–µ)
4. ‚úÖ `BGI`, `deviation`, `ISF`, `target_bg` –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É—é—Ç—Å—è (–∫–∞–∫ –≤ –æ—Ä–∏–≥–∏–Ω–∞–ª–µ)
5. ‚úÖ –ê–ª–≥–æ—Ä–∏—Ç–º —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ—á–Ω–æ –∫–∞–∫ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π JavaScript
6. ‚úÖ –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å Nightscout —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞
7. ‚úÖ UI –º–æ–∂–µ—Ç —Å–∞–º –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–∏

---

## üìù –°—Å—ã–ª–∫–∏ –Ω–∞ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –∫–æ–¥

1. **bg –Ω–µ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è**: determine-basal.js (–Ω–µ—Ç convert_bg –¥–ª—è rT.bg)
2. **eventualBG –Ω–µ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è**: determine-basal.js:698
   ```javascript
   rT.eventualBG = eventualBG;  // for FreeAPS-X needs to be in mg/dL
   ```
3. **predBGs –Ω–µ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É—é—Ç—Å—è**: determine-basal.js:657,667,677,690
   ```javascript
   rT.predBGs.IOB = IOBpredBGs;  // –±–µ–∑ convert_bg
   ```
4. **BGI –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è**: determine-basal.js:806
   ```javascript
   rT.BGI = convert_bg(bgi, profile);
   ```

---

## üéØ –í—ã–≤–æ–¥

**–û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ—Ö—Ä–∞–Ω–µ–Ω**.

–ê–ª–≥–æ—Ä–∏—Ç–º —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ mg/dL (–∫–∞–∫ –∏ –∑–∞–¥—É–º–∞–Ω–æ).
–ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Ç–æ–ª—å–∫–æ –¥–ª—è –∑–Ω–∞—á–µ–Ω–∏–π, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é (BGI, deviation, ISF, target_bg).

---

**–ê–≤—Ç–æ—Ä**: AI Assistant (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –ø–æ—Å–ª–µ –∑–∞–º–µ—á–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)  
**–î–∞—Ç–∞**: 2025-10-07
